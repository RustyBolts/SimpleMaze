require=function s(c,r,a){function h(e,t){if(!r[e]){if(!c[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=r[e]={exports:{}};c[e][0].call(n.exports,function(t){return h(c[e][1][t]||t)},n,n.exports,s,c,r,a)}return r[e].exports}for(var u="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,e,i){"use strict";e.exports=function(t,e,i,o){e=e||"&",i=i||"=";var n={};if("string"!=typeof t||0===t.length)return n;var s=/\+/g;t=t.split(e);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var r,a,h=t.length;0<c&&c<h&&(h=c);for(var u=0;u<h;++u){var d,l,f,_,p=t[u].replace(s,"%20"),m=p.indexOf(i);0<=m?(d=p.substr(0,m),l=p.substr(m+1)):(d=p,l=""),f=decodeURIComponent(d),_=decodeURIComponent(l),r=n,a=f,Object.prototype.hasOwnProperty.call(r,a)?v(n[f])?n[f].push(_):n[f]=[n[f],_]:n[f]=_}return n};var v=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],2:[function(t,e,i){"use strict";var s=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(i,o,n,t){return o=o||"&",n=n||"=",null===i&&(i=void 0),"object"==typeof i?r(a(i),function(t){var e=encodeURIComponent(s(t))+n;return c(i[t])?r(i[t],function(t){return e+encodeURIComponent(s(t))}).join(o):e+encodeURIComponent(s(i[t]))}).join(o):t?encodeURIComponent(s(t))+n+encodeURIComponent(s(i)):""};var c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function r(t,e){if(t.map)return t.map(e);for(var i=[],o=0;o<t.length;o++)i.push(e(t[o],o));return i}var a=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],3:[function(t,e,i){"use strict";i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":1,"./encode":2}],CharacterManager:[function(t,e,i){"use strict";cc._RF.push(e,"cf7b3Mv9RRF57pjK8HT40/s","CharacterManager");var r=t("Firebase");cc.Class({extends:cc.Component,properties:{Refer:"Boardgame/DoorRoom/",Field:"Field/",Character:cc.Node,CharacterLayout:cc.Node,GateLayout:cc.Node,FloorLayout:cc.Node,XY:cc.Label,ScoreLabel:cc.Label,Dialog:t("HintWindow"),_characterList:null},onLoad:function(){this._uniqueid="",this._nickname="",this._monsterId="",this._axisX=0,this._axisY=0,this._standHere=0,this._score=0},login:function(t){var o=this;this._nickname=NAERT.localStorage.getItem("nickname","路人_"+Math.round(100*Math.random())),this._uniqueid=NAERT.localStorage.getItem("uniqueid",NAERT.randomUniqueCode()),!t&&(this._axisX=1),this.FloorLayout&&this.FloorLayout.getChildren().forEach(function(t,e){t.on(cc.Node.EventType.TOUCH_START,function(t){cc.log("this._ismonster",o._ismonster),o._ismonster&&r.refresh(o.Refer+o.Field+"tile_"+o._axisX+"_"+o._axisY+"/"+(e+4)+"/items/","jin"),o.moveToTile(o._axisX,o._axisY,4+e,!1)})}),this._characterList={},r.check(this.Refer+this.Field+"ranking/"+this._uniqueid).then(function(t){var e=t.success,i=t.data;return e&&(o._maxScore=i.score)}),this._addPlayerInfoListener()},moveToTile:function(t,e,i,o){this._axisX=t,this._axisY=e,this._isChangeRoom=o,this.XY.string=t+","+e+":"+i,r.refresh(this.Refer+this.Field+"players/"+this._uniqueid+"/axis/",{x:t,y:e,stand:i}),this._refreshCharacterPosition()},setGatesInfo:function(t){this._gatesInfo=t},setFloorsInfo:function(t){this._floorsInfo=t},recording:function(){this._ismonster&&r.refresh(this.Refer+this.Field+"ranking/"+this._uniqueid,{name:this._nickname,score:Math.max(this._maxScore,this._score)})},isMonster:function(){return this._ismonster},_addPlayerInfoListener:function(){var s=this,c=this.Refer+this.Field+"players/";r.listen(c,function(t){var e=t.success,n=t.data;t.num;e&&Object.keys(n).forEach(function(o){if(!s._characterList[o]){var t=s.CharacterLayout.getChildren().find(function(t){return t.name==o});t||((t=cc.instantiate(s.Character)).name=o,t.parent=s.CharacterLayout,t.active=!1);var e=t.getComponent("Character");e.setInfo(o,n[o]),s._characterList[o]=e;var i=c+o+"/";r.listen(i+"axis",function(t){var e=t.success,i=t.data;return e&&s._setCharacterPosition(o,i)}),o==s._uniqueid&&(s._ismonster=1==n[o].status,r.listen(i+"catch",function(t){var e=t.success,i=t.data;return e&&s._earnScore(i)}),r.listen(i+"pick",function(t){var e=t.success,i=t.data;return e&&s._earnScore(i)}))}})})},_removePlayerInfoListener:function(t){this._characterList[t]=null,r.remove(this.Refer+this.Field+"players/"+t)},_setCharacterPosition:function(t,e){var i=this,o=this._gatesInfo.concat(this._floorsInfo),n=this._characterList[t],s=n.node;if(e.x==this._axisX&&e.y==this._axisY){s.active=!0;var c=e.stand;if(!n.checkUnmoved(e)){n.setStand(c);var r=c<4?this.GateLayout.children[c].position:this.FloorLayout.children[c-4].position;this._moveTo(s,r.x,r.y)}var a=o[c];t!=this._uniqueid?(cc.log("跟自己站在同一格時",t,this._characterList[this._uniqueid].getStand()==c),this._characterList[this._uniqueid].getStand()==c&&Object.keys(this._characterList).forEach(function(t){i._characterList[t].isMonster()&&i._catched(i._uniqueid,t)})):!this._ismonster&&a&&"jin"==a.items&&this._takeJin(e),3<c&&!a.exist&&this._falling(s)}else s.active=!1;n.setAxis(e)},_refreshCharacterPosition:function(){var i=this;Object.keys(this._characterList).forEach(function(t){var e=i._characterList[t];e.node.active=e.checkSameTile(i._axisX,i._axisY)})},_catched:function(t,e){cc.log(e,"catch",t),r.destroy(this.Refer+this.Field+"players/"+t),this._characterList[t].node.destroy(),r.refresh(this.Refer+this.Field+"players/"+e+"/catch/",data.catch+1)},_falling:function(t){cc.log("掉下去啦"),t.runAction(cc.fadeTo(.5,0)),!this._ismonster&&this.Dialog.trap()},_takeJin:function(t){cc.log("吃祲",t);var o=this.Refer+this.Field+"players/"+this._uniqueid+"/";r.destroy(this.Refer+this.Field+"tile_"+t.x+"_"+t.y+"/"+t.stand+"/items/"),r.check(o).then(function(t){var e=t.success,i=t.data;e&&r.refresh(o+"pick",i.pick+1)})},_moveTo:function(t,e,i){t.stopAllActions(),t.setScale(1,1),this._isChangeRoom?t.setPosition(e,i):t.runAction(cc.sequence(cc.spawn(cc.fadeTo(.1,255),cc.scaleTo(.1,1.2,1),cc.moveTo(.1,t.x,t.y-10)),cc.spawn(cc.scaleTo(.1,1,1.2),cc.moveTo(.1,e,i+20)),cc.spawn(cc.scaleTo(.2,1,1),cc.moveTo(.2,e,i))))},_earnScore:function(t){var e=this.ScoreLabel.node;this._score=t,this.ScoreLabel.string="Score:"+t,e.stopAllActions(),e.setScale(1,1),e.runAction(cc.sequence(cc.spawn(cc.scaleTo(.2,2,2).easing(cc.easeElasticOut()),cc.tintTo(.2,255,0,0)),cc.spawn(cc.scaleTo(.3,1,1),cc.tintTo(.3,255,255,255))))}}),cc._RF.pop()},{Firebase:"Firebase",HintWindow:"HintWindow"}],Character:[function(t,e,i){"use strict";cc._RF.push(e,"de75bxS33BBrLYAWSRnVN+c","Character");cc.Class({extends:cc.Component,properties:{NameLabel:cc.Label},onLoad:function(){this._axis={x:-999,y:-999,stand:-1},this._isMonster=!1},setInfo:function(t,e){var i=e.name,o=e.status;t,this._isMonster=1==o,cc.log(i,this._isMonster),this.NameLabel.string=i,this._isMonster?this.node.children[1].active=!0:this.node.children[0].active=!0},setStand:function(t){this._standHere=t},getStand:function(){return this._standHere},isMonster:function(){return this._isMonster},setAxis:function(t){this._axis=t},getAxis:function(){return this._axis},checkSameTile:function(t,e){return!!this._axis&&(t==this._axis.x&&e==this._axis.y)},checkUnmoved:function(t){var e=t.x,i=t.y,o=t.stand;return e==this._axis.x&&i==this._axis.y&&o==this._axis.stand}}),cc._RF.pop()},{}],ControlFlip:[function(t,e,i){"use strict";cc._RF.push(e,"6560dEzMixJRqADBtX84cYi","ControlFlip"),cc.Class({extends:cc.Component,onLoad:function(){this._positionStart=new cc.v2(0,0),this._positionEnd=new cc.v2(0,0),this._enableLimit=.2*this.node.width,this._activeCount=0,cc.log(this._enableLimit)},update:function(){if(0<this._activeCount){this._activeCount--;var t=this.node.position.x,e=this.node.position.y,i=this._positionEnd.x,o=this._positionEnd.y;this.node.position=new cc.v2(t+.5*(i-t),e+.5*(o-e))}},onPress:function(t){},onDrag:function(t,e){if(this.node.active){var i=this._positionEnd;this._positionEnd=new cc.v2(i.x+e.x,i.y+e.y),this._activeCount=5}},onRelease:function(t){if(this.node.active){var e={x:this._positionEnd.x-this._positionStart.x,y:this._positionEnd.y-this._positionStart.y},i=Math.abs(e.x),o=Math.abs(e.y);o<i&&i>this._enableLimit?e.x<0?NAERT.dispatchCustomEvent("NotifyUIControlFlip",UIEnum.Flip.RIGHT,this):NAERT.dispatchCustomEvent("NotifyUIControlFlip",UIEnum.Flip.LEFT,this):i<o&&o>this._enableLimit&&(0<e.y?NAERT.dispatchCustomEvent("NotifyUIControlFlip",UIEnum.Flip.DOWN,this):NAERT.dispatchCustomEvent("NotifyUIControlFlip",UIEnum.Flip.UP,this)),this._positionEnd=this._positionStart,this._activeCount=10}}}),cc._RF.pop()},{}],ControlFoldList:[function(t,e,i){"use strict";cc._RF.push(e,"05051PcmtNASKvrFh6hJukg","ControlFoldList"),cc.Class({extends:cc.Component,onLoad:function(){this._positionStart=new cc.v2(0,0),this._positionEnd=new cc.v2(0,0),this._enableLimit=.3*this.node.width,this._activeCount=0,this._type=1},update:function(){if(0<this._activeCount){this._activeCount--;var t=this.node.position.x,e=this.node.position.y,i=this._positionEnd.x,o=this._positionEnd.y;this.node.position=new cc.v2(t+.5*(i-t),e+.5*(o-e))}},onPress:function(t){},onDrag:function(t,e){if(this.node.active){var i=this._positionEnd;this._positionEnd=new cc.v2(i.x+e.x,i.y+e.y),this._activeCount=5}},onRelease:function(t){if(this.node.active){var e={x:this._positionEnd.x-this._positionStart.x,y:this._positionEnd.y-this._positionStart.y};Math.abs(e.x)>this._enableLimit?e.x<0?cc.log(this._type--):cc.log(this._type++):(Math.abs(e.y),this._enableLimit),this._positionEnd=this._positionStart,this._activeCount=10}}}),cc._RF.pop()},{}],ControlMain:[function(t,e,i){"use strict";cc._RF.push(e,"abd7eFOMIBOkanzrnsRipFd","ControlMain"),cc.Class({extends:cc.Component,properties:{startTaps:[cc.Component.EventHandler],currentTaps:[cc.Component.EventHandler],finishTaps:[cc.Component.EventHandler]},onLoad:function(){},start:function(){var o=this,t=this.node;t.on(cc.Node.EventType.TOUCH_START,function(t){var e=t.touch.getLocation();o.startTaps.forEach(function(t){return t.emit([e])})}),t.on(cc.Node.EventType.TOUCH_MOVE,function(t){var e=t.touch.getLocation(),i=t.touch.getDelta();o.currentTaps.forEach(function(t){return t.emit([e,i])})}),t.on(cc.Node.EventType.TOUCH_END,function(t){var e=t.touch.getLocation();o.finishTaps.forEach(function(t){return t.emit([e])})}),t.on(cc.Node.EventType.TOUCH_CANCEL,function(t){var e=t.touch.getLocation();o.finishTaps.forEach(function(t){return t.emit([e])})})},onDestroy:function(){}}),cc._RF.pop()},{}],ControlPullPush:[function(t,e,i){"use strict";cc._RF.push(e,"e388eoHOadFu5uNWD91eCy1","ControlPullPush"),cc.Class({extends:cc.Component,properties:{DelaySec:1},onLoad:function(){this._positionStart=new cc.v2(0,0),this._positionEnd=new cc.v2(0,0),this._enableLimit=.2*this.node.width,this._activeCount=0,cc.log(this._enableLimit)},update:function(){if(0<this._activeCount){this._activeCount--;var t=this.node.position.x,e=this.node.position.y,i=this._positionEnd.x,o=this._positionEnd.y;this.node.setPosition(t+.05*(i-t),e+.05*(o-e))}},onPress:function(t){this.schedule(this._finishTap.bind(this),this.DelaySec)},onDrag:function(t,e){if(this.node.active){var i=this._positionEnd;this._positionEnd=new cc.v2(i.x+e.x,i.y+e.y),this._activeCount=50}},onRelease:function(t){this.node.active&&(this.unscheduleAllCallbacks(),this._sendCommand("NotifyUIControlFlip",{x:this._positionEnd.x-this._positionStart.x,y:this._positionEnd.y-this._positionStart.y}),this._positionEnd=this._positionStart,this._activeCount=100)},_finishTap:function(){this._sendCommand("NotifyUIControlPullPush",{x:this._positionEnd.x-this._positionStart.x,y:this._positionEnd.y-this._positionStart.y})},_sendCommand:function(t,e){var i=Math.abs(e.x),o=Math.abs(e.y);o<i&&i>this._enableLimit?NAERT.dispatchCustomEvent(t,e.x<0?UIEnum.Flip.RIGHT:UIEnum.Flip.LEFT,this):i<o&&o>this._enableLimit?NAERT.dispatchCustomEvent(t,0<e.y?UIEnum.Flip.DOWN:UIEnum.Flip.UP,this):NAERT.dispatchCustomEvent(t,-1,this)}}),cc._RF.pop()},{}],Dice:[function(t,e,i){"use strict";cc._RF.push(e,"26c5dUk38VEDI2GKHVssFk5","Dice"),cc.Class({extends:cc.Component,properties:{Hint:cc.Label,Points:[cc.String],Logo:cc.Sprite,Icons:[cc.Graphics]},onLoad:function(){this._base=0,this._value=1,this._record={point:0,icon:null,hint:""},this._list=[]},start:function(){0<this.Icons.length?(this._list=this.Icons,!this.Logo&&cc.error("未設定骰子圖示")):0<this.Points.length?(this._list=this.Points,!this.Hint&&cc.error("未設定骰子文字")):cc.error("未設定骰子"),this.base(1).dice().show()},onEnable:function(){this._init()},onDisable:function(){this._init()},base:function(t){return this._base=t,this},value:function(t){return this._value=t,this},dice:function(){var t=Object.keys(this._list).sort(function(){return.5-Math.random()})[0],e=parseInt(t,10),i=this.Icons?this._list[e]:null;return this._record={point:e,icon:i,hint:t},cc.log(this._record),this},show:function(){return this.Hint?this.Hint.string=this._list[this._record.point]:this.Icons&&cc.log("ok"),this},hit:function(){return this.dice().show(),this._easeBounceOut(this.node,200,.9),this._easeBounceOut(this.Hint.node,120,.5),this},rotate:function(t){return this},lock:function(){},collect:function(){return(this._record.point+this._base)*this._value},_init:function(){this._record={point:0,icon:null,hint:""},this.Hint.string=""},_easeBounceOut:function(t,e,i){t.opacity=e,t.setScale(i,i),t.runAction(cc.spawn(cc.fadeTo(.2,255),cc.scaleTo(.4,1,1).easing(cc.easeBounceOut())))}}),cc._RF.pop()},{}],DoorRoomItem:[function(t,e,i){"use strict";cc._RF.push(e,"93b78u7AI9DSq6V0ePiygJz","DoorRoomItem"),cc.Class({extends:cc.Component,properties:{GateLayout:cc.Node,FloorLayout:cc.Node},onLoad:function(){this._axis={},this._gates=[],this._floors=[]},setRef:function(t){this._refPath=t},setAxis:function(t){this._axis=t},randomExist:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return new Array(t).fill(!1).map(function(t){return{exist:Math.random()>e}})},randomGates:function(){return this.randomExist(4,.5)},randomFloors:function(t){return this.randomExist(t,.2)},checkPass:function(t){return this._gates[t].exist},checkUnmoved:function(t){var e=t.x,i=t.y,o=t.stand;return cc.log("check nmoved:",this._axis,e,i),e==this._axis.x&&i==this._axis.y&&o==this._axis.stand},showGates:function(i,t){this._gates=i,this.GateLayout.getChildren().forEach(function(t,e){return t.active=i[e].exist}),this._showGates()},showFloors:function(i){var t=this.FloorLayout.getChildren();this._floors=i,cc.log(i),t.forEach(function(t,e){return cc.log(e,i[e])}),t.forEach(function(t,e){return t.opacity=i[e].exist?255:0}),this._showFloors(t)}}),cc._RF.pop()},{}],DoorRoomMap:[function(t,e,i){"use strict";cc._RF.push(e,"4586albIBNKSJywy9IA4Yd6","DoorRoomMap");var n=t("Firebase");cc.Class({extends:cc.Component,properties:{Refer:"Boardgame/DoorRoom/",Field:"Field/",Size:50,DoorRoomItem:cc.Node,RankList:cc.Label,CloseButton:cc.Node,MyRoom:t("SimpleMaze")},onLoad:function(){var o=this;this.node.opacity=0,this._isShow=!1,n.listen(this.Refer+this.Field,this._showMap.bind(this)),n.listen(this.Refer+this.Field+"heartbeat/",function(t){var e=t.success,i=t.data;return e&&o._checkBeat(i)}),n.listen(this.Refer+this.Field+"rank/",this._rankList.bind(this))},_showMap:function(t){var s=this,e=t.success,i=t.data;if(e){var o=this.MyRoom.getRoomAxis(),c=o[0].toString(),r=o[1].toString(),a=this.node.getChildren();Object.keys(i).forEach(function(t,e){t.replace(/tile_(.*)_(.*)/,function(t,e,i){var o="tile_"+e+"_"+i,n=a.find(function(t){return t.name==o});n||((n=cc.instantiate(s.DoorRoomItem)).name=o,n.parent=s.node,n.active=!0,n.setPosition(e*s.Size,i*s.Size),n.getComponent("DoorRoom").load(e,i,1,0)),n.color=c==e&&r==i?cc.Color.RED:cc.Color.GRAY})})}},_checkBeat:function(t){var i=this.node.getChildren();Object.keys(t).forEach(function(e){var t=i.find(function(t){return t.name==e});t.stopAllActions(),t.setScale(1,1),t.runAction(cc.sequence(cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1),cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1),cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1)))})},_rankList:function(t){var i=this,e=t.success,o=t.data;e&&(this.RankList.string="==RANK LIST==",Object.keys(o).sort(function(t,e){return o[t].score<o[e].score}).slice(0,7).forEach(function(t,e){return i.RankList.string+="\n"+(e+1)+" "+o[t].name+" : "+o[t].score+" 分"}))},clickOnVisible:function(){this.node.active=!0,this._isShow=!this._isShow,this.node.opacity=this._isShow?80:0}}),cc._RF.pop()},{Firebase:"Firebase",SimpleMaze:"SimpleMaze"}],DoorRoomMazeItem:[function(t,e,i){"use strict";cc._RF.push(e,"ac1f9cravZAVqqmtBEzfuqz","DoorRoomMazeItem");var p=t("Firebase");cc.Class({extends:t("DoorRoomItem"),properties:{FloorLayout:cc.Node,CharacterLayout:cc.Node,Character:cc.Node,BlockLayout:cc.Node,Block:cc.Node,ItemLayout:cc.Node,Item:cc.Node,Dialog:t("HintWindow"),Heartbeat:t("Heartbeat")},onLoad:function(){this._gates=[],this._floors=[],this._standHere=-1,this._standCode="",this._uniqueid=NAERT.localStorage.getItem("uniqueid",NAERT.randomUniqueCode()),this._stake=[],this._monster="",this._immonster=!1,this.addListener()},setRef:function(t){this._refPath=t,this._stake=[],this.doorRoomMoved()},addListener:function(){var i=this;this.FloorLayout&&this.FloorLayout.getChildren().forEach(function(t,e){t.on(cc.Node.EventType.TOUCH_START,i._standOnFloor.bind(i,e))})},notifyMonster:function(t){this._monster=t,this._immonster=t==this._uniqueid,this._immonster&&this.Heartbeat.noHeart()},randomGates:function(){return new Array(4).fill(!1).map(function(t){return{exist:.5<Math.random()}})},randomFloors:function(t){return new Array(t).fill(!1).map(function(t){return{exist:.2<Math.random()}})},randomItem:function(t){var o=this;t.find(function(t,e){var i=e+4;if(t.exist&&.8<Math.random())return p.record(o._refPath+"/"+i+"/block/","block"),!0})},notify:function(){this.Dialog.catched(),this.stay(-1),this.Heartbeat.eating(),this.Heartbeat.music(.1)},showGates:function(t,i){this.GateLayout.getChildren().forEach(function(t,e){return t.active=i[e].exist}),this._gates=i,-1<this._standHere&&this._addPug(t),!this._immonster&&this.Heartbeat.pressureUp()},showFloors:function(i){this.Character.active=!1,this.Block.active=!1,this.Item.active=!1,this.FloorLayout&&this.FloorLayout.getChildren().forEach(function(t,e){i[e].exist?t.color=cc.Color.GRAY:t.color=cc.Color.BLACK}),this._floors=i},getTilesPostion:function(t){return t<4?this.GateLayout.children[t].position:this.FloorLayout.children[t-4].position},checkPass:function(t){return this._gates[t].exist},moveIn:function(t){t.stopAllActions(),t.setScale(1,1),t.runAction(cc.sequence(cc.scaleTo(.3,1.2,1.2).easing(cc.easeElasticOut()),cc.scaleTo(.5,1,1).easing(cc.easeElasticIn())))},stay:function(t){t<0?this._removePug():this._standOnFloor(t)},passGate:function(e){var i=this,o=this._refPath;this._standInGate(e),this.scheduleOnce(function(t){p.destroy(o+"/"+e+"/characters/"+i._standCode)},.1)},doorRoomMoved:function(){var _=this;this._prevRef&&p.remove(this._prevRef),this._prevRef=this._refPath,p.listen(this._refPath,function(t){var e=t.success,i=t.data;if(e){var u=-1,d=!1,l=_.CharacterLayout.getChildren(),f=_.ItemLayout.getChildren();l.forEach(function(t){return t.active=!1}),f.forEach(function(t){return t.active=!1}),Object.keys(i).map(function(t){return i[t]}).forEach(function(t,n){var o=_.getTilesPostion(n),s=t.characters,e=t.block,i=t.traps,c=t.items;if(s){var r=Object.keys(s);r.forEach(function(t){var e=s[t],i=l.find(function(t){return t.name==e});i||((i=cc.instantiate(_.Character)).name=e,i.parent=_.CharacterLayout,e==_._monster?(i.children[0].active=!1,i.children[1].active=!0):(i.children[0].active=!0,i.children[1].active=!1)),i.active=!0,_._moveTo(i,o.x,o.y,n),e==_._uniqueid?(i.children[0].color=cc.Color.GREEN,u=n):e==_._monster&&(cc.log("有怪物"),!_._immonster&&(d=!0))}),r.find(function(t){var o=s[t];if(u==n&&o!=_._uniqueid&&(cc.log("有人！"),o==_._monster))return cc.log("被抓到了！",o,_._uniqueid),p.check(_.Refer+_.Field+"players/"+o).then(function(t){var e=t.success,i=t.data;e&&(_.stay(-1),_.notify(),p.destroy(_.Refer+_.Field+"players/"+_._uniqueid),p.refresh(_.Refer+_.Field+"players/"+o+"/catch/",i.catch+1))}),!0})}if(e&&(_.Block.active=!0,_.Block.setPosition(o.x,o.y),cc.log("block",n),n==u&&_.moveIn(_.Block)),i&&cc.log("有陷阱"),c){var a=c,h=f[n]||cc.instantiate(_.Item);h.name=a,h.parent=_.ItemLayout,h.active=!0,h.setPosition(o.x,o.y),n!=u||_._immonster||(cc.log("撿東西"),p.destroy(_._refPath+"/"+n+"/items/"),p.check(_.Refer+_.Field+"players/"+_._uniqueid).then(function(t){var e=t.success,i=t.data;e&&p.refresh(_.Refer+_.Field+"players/"+_._uniqueid+"/pick/",i.pick+1)}))}}),d?(_.Heartbeat.roar(),_.Heartbeat.pressureUp()):_.Heartbeat.roar(0),_.Heartbeat.boom()&&NAERT.dispatchCustomEvent("NotifyHeartbeat",!0,_)}})},_moveTo:function(t,e,i,o){t.stopAllActions(),t.setScale(1,1),o<4?t.setPosition(e,i):t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,1.2,1),cc.moveTo(.1,t.x,t.y-10)),cc.spawn(cc.scaleTo(.1,1,1.2),cc.moveTo(.1,e,i+20)),cc.spawn(cc.scaleTo(.2,1,1),cc.moveTo(.2,e,i))))},_standInGate:function(t){this._removePug(),this._addPug(t)},_standOnFloor:function(t){this._removePug(),this._addPug(t+4),!this._floors[t].exist&&NAERT.dispatchCustomEvent("NotifyDoorRoomTrap",t,this),this._immonster&&0<Math.random()&&p.refresh(this._refPath+"/"+(t+4)+"/items/","jin")},_addPug:function(t){var e=this;cc.log("add pug",this._standHere),this._standHere=t,p.record(this._refPath+"/"+this._standHere+"/characters/",this._uniqueid).then(function(t){return e._standCode=t})},_removePug:function(){var n=this;cc.log("remove pug",this._standHere,this._standCode),-1<this._standHere&&(p.destroy(this._refPath+"/"+this._standHere+"/characters/"+this._standCode),p.check(this._refPath).then(function(t){var e=t.success,i=t.data;e&&Object.keys(i).map(function(t){return i[t]}).forEach(function(t,i){var o=t.characters;o&&Object.keys(o).forEach(function(t,e){o[t]==n._uniqueid&&p.destroy(n._refPath+"/"+i+"/characters/"+t)})})}))},_reloadwebsite:function(){window.location.reload()},clickOnFloor:function(t){cc.log(t),this._standOnFloor(t)},clickOnTrap:function(t){NAERT.dispatchCustomEvent("NotifyDoorRoomTrap",!0,this),this._standOnFloor(t),this.Dialog.trap(t)}}),cc._RF.pop()},{DoorRoomItem:"DoorRoomItem",Firebase:"Firebase",Heartbeat:"Heartbeat",HintWindow:"HintWindow"}],DoorRoom:[function(t,e,i){"use strict";cc._RF.push(e,"32f62XLUwRHCrXfXzsqAXlB","DoorRoom");var l=t("Firebase");cc.Class({extends:cc.Component,properties:{Refer:"Boardgame/DoorRoom/",Field:"Field/",Mask:cc.Node,FloorNumber:9,RoomItem:t("DoorRoomItem")},onLoad:function(){this._prevLoaded={x:-999,y:-999}},load:function(o,n,s,c){var r=this;if(cc.log(this._prevLoaded.x," == ",o,"&&",this._prevLoaded.y," == ",n),this._prevLoaded.x!=o||this._prevLoaded.y!=n){this._preRef&&l.remove(this._preRef);var t=this.getTilePath(o,n,s);this._preRef=t,this.RoomItem.setRef(t),this.RoomItem.setAxis({x:o,y:n,stand:c}),this.Mask.opacity=255,l.listen(t,function(t){var e=t.success,i=t.data;r._prevLoaded={x:o,y:n},cc.log("this._prevLoaded:",r._prevLoaded),e?r._showRoom(c,i):r.create(o,n,s,c,r.RoomItem.randomGates(),r.RoomItem.randomFloors(r.FloorNumber))})}},create:function(n,s,c,r,a,h){var u=this,d=0;[[n,s+1],[n-1,s],[n,s-1],[n+1,s]].forEach(function(t,o){l.check(u.getTilePath(t[0],t[1],c)).then(function(t){var e=t.success,i=t.data;e&&(a[o]=i[(o+2)%4]),4==++d&&(l.refresh(u.getTilePath(n,s,c),a.concat(h)),u._showRoom(r,a.concat(h)))})})},hideRoom:function(){var e=this;this.Mask.runAction(cc.sequence(cc.fadeTo(.1,255),cc.callFunc(function(t){return e.node.active=!1}))),this._prevLoaded={x:-9999,y:-9999}},getTilePath:function(t,e,i){return this.Refer+this.Field+this._tileName(t,e,i)+"/"},_tileName:function(t,e,i){return"tile_"+t*i+"_"+e*i},_showRoom:function(t,e){cc.log("showRoom",e),this.RoomItem.showGates(e.splice(0,4),t),this.RoomItem.showFloors(e),this.Mask.runAction(cc.fadeTo(.1,120))}}),cc._RF.pop()},{DoorRoomItem:"DoorRoomItem",Firebase:"Firebase"}],EventButton:[function(t,e,i){"use strict";cc._RF.push(e,"8d40bEHs/lO7YmE02m0JEBx","EventButton"),cc.Class({extends:cc.Component,properties:{Hint:cc.Label},setInfo:function(t){this.Hint.string=t.hint,this._callback=t.cb,this._closeDialog=t.close},onClick:function(){this._callback&&this._callback(),this._closeDialog()}}),cc._RF.pop()},{}],EventDestroy:[function(t,e,i){"use strict";cc._RF.push(e,"bf3d2yx1xdDZKQEuxNgX+du","EventDestroy"),cc.Class({extends:cc.Component,addEventParam:function(t){this._registeredEventArray||(this._registeredEventArray=[]),this._registeredEventArray.push(t)},onDestroy:function(){this._registeredEventArray&&this._registeredEventArray.forEach(function(t){NAERT.removeCustomEvent(t.name,t.func,t.target)})}}),cc._RF.pop()},{}],EventHover:[function(t,e,i){"use strict";cc._RF.push(e,"c11c6M/2lJN4K1PslvMgoaS","EventHover"),cc.Class({extends:cc.Component,properties:{hoverEvents:[cc.Component.EventHandler]},onLoad:function(){this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onRollOver,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onRollOut,this)},_onRollOver:function(){if(!this._hovered){this._hovered=!0;var t=new cc.Event.EventCustom;t.detail={isHoverd:this._hovered},t.target=this.node,cc.Component.EventHandler.emitEvents(this.hoverEvents,t)}},_onRollOut:function(){if(this._hovered){this._hovered=!1;var t=new cc.Event.EventCustom;t.detail={isHoverd:this._hovered},t.target=this.node,cc.Component.EventHandler.emitEvents(this.hoverEvents,t)}}}),cc._RF.pop()},{}],Firebase:[function(t,e,i){"use strict";cc._RF.push(e,"a8ecbg8kYhNwZZXeTLu0wxb","Firebase");var o=null,n=[],s=function(){var t=new Promise(function(t){o?t(o):n.push({resolve:t})});return 1==n.length&&cc.loader.load("https://www.gstatic.com/firebasejs/4.2.0/firebase.js",function(t){if(t)return console.log("firebase error: "+t);o=firebase.initializeApp({apiKey:"AIzaSyAc5PRwmE14gBH5az8TSoqs9aBrQ8YWa4o",authDomain:"fir-test-756e1.firebaseapp.com",databaseURL:"https://fir-test-756e1.firebaseio.com",projectId:"fir-test-756e1",storageBucket:"fir-test-756e1.appspot.com",messagingSenderId:"182531440628"}).database(),n.forEach(function(t){t.resolve(o)}),n.length=0}),t};e.exports={getUID:function(){return 0},record:function(i,o){return new Promise(function(e,t){i?s().then(function(t){e(t.ref(i).push(o).getKey())}):t("none_ref")})},refresh:function(i,o){return new Promise(function(e,t){i?s().then(function(t){t.ref(i).set(o,function(t){e(null==t)})}):t("none ref")})},destroy:function(e){e?s().then(function(t){t.ref(e).remove()}):cc.error("none ref")},remind:function(e,i){e?s().then(function(t){t.ref(e).set(i),t.ref(e).remove()}):cc.error("none ref")},listen:function(e,o){s().then(function(t){t.ref(e).on("value",function(t){var e=t.val(),i=t.numChildren();o(null!=e?{success:!0,data:e,num:i}:{success:!1})})})},check:function(e){return new Promise(function(o){s().then(function(t){t.ref(e).once("value",function(t){var e=t.val(),i=t.numChildren();o(null!=e?{success:!0,data:e,num:i}:{success:!1})})})})},remove:function(e){s().then(function(t){t.ref(e).off()})}},cc._RF.pop()},{}],GoogleLogin:[function(t,e,i){"use strict";cc._RF.push(e,"1a611h0p65NCo14EcDtPH+y","GoogleLogin");t("Firebase");cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{Firebase:"Firebase"}],HeartbeatMaze:[function(t,e,i){"use strict";cc._RF.push(e,"1d098oefGJP4bUgekTyGj3f","HeartbeatMaze");var s=t("Firebase");cc.Class({extends:cc.Component,properties:{Refer:"Boardgame/DoorRoom/",Field:"Heartbeat/",EscapeValue:5,LoginDialog:t("HintWindow"),Dialog:t("HintWindow")},onLoad:function(){this._axisX=0,this._axisY=0},start:function(){this.LoginDialog.login(NAERT.localStorage.getItem("nickname","路人_"+Math.round(100*Math.random()))),NAERT.addListener("NotifyPlayerLogin",this.onStart.bind(this))},onStart:function(t){var n=this;this._nickname=t.detail.name,this._uniqueid=NAERT.localStorage.getItem("uniqueid",NAERT.randomUniqueCode()),s.check(this.Refer+this.Field+"players/").then(function(t,e){cc.log(e),s.refresh(n.Refer+n.Field+"players/"+n._uniqueid,{name:n._nickname,hp:3,catch:0,pick:0,status:e?0:1,axis:{x:0,y:0,stand:8}}).then(function(t){var e=n.node.children,i=e[0],o=e[1];i.getComponent("DoorRoom").load(n._axisX,n._axisY,1,8),o.getComponent("DoorRoom").load(n._axisX,n._axisY,1,8),i.getComponent("DoorRoomItem").playerLogin(!0),o.getComponent("DoorRoomItem").playerLogin(),n.node.children[1].active=!1,n._addListener()})})},onMasterStart:function(){var e=this,i=this.node.children[0].getComponent("DoorRoom");i.Mask.opacity=255,s.check(i.getTilePath(0,0,1)).then(function(t){t.success?i.load(0,0,1,8):i.create(0,0,1,8,e._defaultGatesData(),e._defaultFloorsData())})},getRoomAxis:function(){return[this._axisX,this._axisY]},_addListener:function(){NAERT.addListener("NotifyUIControlFlip",this._uiControlFlip.bind(this)),NAERT.addListener("NotifyUIControlPullPush",this._uiControlPullPush.bind(this)),window.onbeforeunload=this._onbeforeunload.bind(this)},_uiControlFlip:function(t){var e=t.detail,i=this.node.children,o=i[0],n=i[1];if(-1<e){if(!o.getComponent("DoorRoomItem").checkPass(e))return;var s=this.node.convertToNodeSpace(n.getPosition());switch(n.setSiblingIndex(0),this.node.setPosition(.5*s.x,.5*s.y),o=i[0],n=i[1],o.setPosition(0,0),o.active=!0,n.active=!1,e){case UIEnum.Flip.UP:this._axisY++;break;case UIEnum.Flip.LEFT:this._axisX--;break;case UIEnum.Flip.DOWN:this._axisY--;break;case UIEnum.Flip.RIGHT:this._axisX++}if(Math.abs(this._axisX)>this.EscapeValue||Math.abs(this._axisY)>this.EscapeValue){if(!o.getComponent("DoorRoomItem").Characters.isMonster())return this.Dialog.escape(),void this._ranking();this._axisX=this._axisY=0,this.Dialog.seal()}o.getComponent("DoorRoom").load(this._axisX,this._axisY,1,(e+2)%4),o.getComponent("DoorRoomItem").moveToTile(this._axisX,this._axisY,(e+2)%4,!0)}},_uiControlPullPush:function(t){var e=t.detail,i=this.node.children[0],o=this.node.children[1],n=o.width,s=o.height,c=this._axisX,r=this._axisY;switch(e){case UIEnum.Flip.UP:r+=1,o.setPosition(0,s+50);break;case UIEnum.Flip.LEFT:c-=1,o.setPosition(-n-50,0);break;case UIEnum.Flip.DOWN:r-=1,o.setPosition(0,-s-50);break;case UIEnum.Flip.RIGHT:c+=1,o.setPosition(n+50,0)}if(-1<e){if(!i.getComponent("DoorRoomItem").checkPass(e))return;if(o.getComponent("DoorRoomItem").checkUnmoved({x:c,y:r,stand:e}))return;cc.log("lllooad"),o.getComponent("DoorRoom").load(c,r,1,e),o.getComponent("DoorRoomItem").moveToTile(c,r,e,!1),o.active=!0,i.getComponent("DoorRoomItem").moveToTile(this._axisX,this._axisY,e,!1)}else o.getComponent("DoorRoom").hideRoom()},_reloadwebsite:function(){window.location.reload()},_onbeforeunload:function(){this.node.children[0].getComponent("DoorRoomItem").Characters.recording(),s.destroy(this.Refer+this.Field+"players/"+this._uniqueid)},_ranking:function(){var n=this;s.check(this.Refer+this.Field+"players/"+this._uniqueid).then(function(t){var e=t.success,i=t.data;if(e){var o=i.catch+i.pick;o&&s.refresh(n.Refer+n.Field+"ranking/"+n._uniqueid,{name:i.name,score:o}),s.destroy(n.Refer+n.Field+"players/"+n._uniqueid)}}),this.node.children[0].getComponent("DoorRoomItem").Characters.recording()},_defaultGatesData:function(){return[{exist:!0},{exist:!0},{exist:!0},{exist:!0}]},_defaultFloorsData:function(){return[{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0}]}}),cc._RF.pop()},{Firebase:"Firebase",HintWindow:"HintWindow"}],Heartbeat:[function(t,e,i){"use strict";cc._RF.push(e,"4a6f0wJoQtHC4v60Ja3LxXb","Heartbeat"),cc.Class({extends:cc.Component,properties:{Heart:cc.Node,HeartLabel:cc.Label},onLoad:function(){this.Heart.active=!1,this._pressure=0,this._isEating=!1,this._bgAudioID=cc.audioEngine.play(cc.url.raw("resources/They_Might_Not.mp3"),!0),cc.audioEngine.setVolume(this._bgAudioID,.05)},onStart:function(){this.Heart.active=!0},pressureUp:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._pressure<10&&(this._pressure+=t),cc.log("增壓",this._pressure),this.pressureDown()},pressureDown:function(){var e=this;this.unscheduleAllCallbacks(),cc.log("減壓",this._pressure),this.HeartLabel.string=10*this._pressure,this.scheduleOnce(function(t){0<e._pressure&&(e._pressure--,e.pressureDown())},5)},boom:function(){return 10==this._pressure},music:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;cc.audioEngine.setVolume(this._bgAudioID,t)},beat:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;null!=this._beatAudioID&&(cc.audioEngine.stop(this._beatAudioID),this._beatAudioID=null),this._beatAudioID=cc.audioEngine.play(cc.url.raw("resources/heartbeat.mp3"),!1),cc.audioEngine.setVolume(this._beatAudioID,t),this.Heart.stopAllActions(),this.Heart.setScale(1,1),this.Heart.runAction(cc.sequence(cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1),cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1),cc.scaleTo(.2,.8,.8).easing(cc.easeElasticOut()),cc.scaleTo(.3,1,1)))},roar:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._isEating||(null!=this._roarAudioID&&(cc.audioEngine.stop(this._roarAudioID),this._roarAudioID=null),this._roarAudioID=cc.audioEngine.play(cc.url.raw("resources/Monster_Alien_Roar_Aggressive.mp3"),!1),cc.audioEngine.setVolume(this._roarAudioID,t))},eating:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;this._isEating=!0,this._roarAudioID,cc.audioEngine.stop(this._roarAudioID),null!=this._eatAudioID&&(cc.audioEngine.stop(this._eatAudioID),this._eatAudioID=null),this._eatAudioID=cc.audioEngine.play(cc.url.raw("resources/Monster_Alien_Grunt_Hiss.mp3"),!1),cc.audioEngine.setVolume(this._eatAudioID,t)},noHeart:function(){this.Heart.active=!1},playMusic:function(t,e){if(t&&0<t.length)return t.indexOf("http")<0&&(t=cc.url.raw(t)),this._bgAudioID=cc.audioEngine.play(t,e),cc.audioEngine.setVolume(this._bgAudioID,100),this._bgAudioID}}),cc._RF.pop()},{}],HintWindow:[function(t,e,i){"use strict";cc._RF.push(e,"f50bb+Ic/9NwZ9oBqnFtump","HintWindow");var o=cc.Enum({NONE:-1,UP_TO_MIDDLE:-1});cc.Class({extends:cc.Component,properties:{Tween:{type:o,default:o.NONE},Hint:cc.Label,EventButton:cc.Node,ButtonLayout:cc.Node},onEnable:function(){switch(this.Tween){case o.UP_TO_MIDDLE:this._tween(this.node,[cc.v2(0,-150),cc.v2(0,0)],[100,255])}},onDisable:function(){this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()})},hint:function(t){this.unschedule(this.close),this.node.active=!0,this.Hint.string=t},print:function(t){this.Hint.string+="\n"+t},button:function(t,e){var i=new cc.instantiate(this.EventButton);i.parent=this.ButtonLayout,i.active=!0,i.getComponent("EventButton").setInfo({hint:t,cb:e,close:this.hide.bind(this)})},interval:function(t){this.scheduleOnce(this.close,t)},hide:function(){this._tween(this.node,[cc.v2(0,0),cc.v2(0,-150)],[255,0]),this.unschedule(this.close),this.interval(.2)},close:function(){this.unschedule(this.close),this.Hint&&(this.Hint.string=""),this.node.active=!1},_tween:function(t,e,i){t.opacity=i[0],t.setPosition(e[0]),t.runAction(cc.spawn(cc.moveTo(.6,e[1]).easing(cc.easeBackOut()),cc.fadeTo(.3,i[1])))}}),cc._RF.pop()},{}],IndexData:[function(t,e,i){"use strict";cc._RF.push(e,"075b8EaHdFAIZIi532HbGNx","IndexData");cc._RF.pop()},{}],ListFolder:[function(t,e,i){"use strict";cc._RF.push(e,"7143fVNo9JFy7EPxyuGnliY","ListFolder");var a=t("Firebase");cc.Class({extends:cc.Component,properties:{Refer:"Boardgame/",Field:"Field/",Prompt:"Prompt",Label:cc.Label,Layout:cc.Node,ListItem:cc.Node,OnTop:!1,Dialog:t("HintWindow"),CheckConditions:[cc.Component.EventHandler],_uniqueid:"",_isUnfold:!1},onLoad:function(){this._viewUniqueid=NAERT.randomUniqueCode(),this._fireData={},this._listData=[],this._checkStatus=!1,this._loaded=!1,this._isUnfold=this.OnTop,NAERT.addListener("NotifyAddNew"+this._viewUniqueid,this.addNewContent.bind(this)),NAERT.addListener("NotifyModify"+this._viewUniqueid,this.editContent.bind(this)),NAERT.addListener("NotifyDelete"+this._viewUniqueid,this.deleteContent.bind(this))},start:function(){var o=this;this.OnTop&&a.check(this.Refer+this.Field).then(function(t){var e=t.success,i=t.data;e?Object.keys(i).forEach(function(t){return o.setUniqueid(t,!0)}):a.record(o.Refer+o.Field,{text:o.Prompt}).then(function(t){return o.setUniqueid(t,!1)})})},foldList:function(t){this._isUnfold=!1,this.Layout.children.forEach(function(t){return t.active=!1}),t&&t()},unfoldList:function(t){this._isUnfold=!0,this.Layout.children.forEach(function(t){return t.active=!0}),t&&t()},addNewContent:function(t){var i=this;if(cc.log(this.node.name),cc.log("add new contetn listitem:",this.ListItem),this.ListItem){var o=this._uniqueid,n=t.detail,s=this.Field+o,c=this.ListItem.getComponent("ListFolder").Field,r="";return new Promise(function(e){a.record(i.Refer+c,{text:n,from:s}).then(function(t){return r=t,i._checkStatus=!1,a.refresh(i.Refer+i.Field+o+"/list/"+r,!1)}).then(function(t){return e(r)})})}},editContent:function(t){var i=this;return new Promise(function(e){a.refresh(i.Refer+i.Field+"/text/",t.detail,i._isUnfold).then(function(t){return e(t)})})},deleteContent:function(){var i=this;return new Promise(function(e){a.check(i.Refer+i._fromPath).then(function(t){t.success?(a.destroy(i.Refer+i.Field+i._uniqueid),a.destroy(i.Refer+i._fromPath+"/list/"+i._uniqueid)):a.destroy(i.Refer+i.Field+i._uniqueid),i.node.destroy(),e(!0)})})},setUniqueid:function(t,e){this.node.active=this._isUnfold=e,this._uniqueid=t,cc.log(this.node.name,"set unique id",t," visible:",this._isUnfold),!this._loaded&&a.listen(this.Refer+this.Field+t,this._showInfo.bind(this)),this._loaded=!0},getUniqueid:function(){return this._uniqueid},checkUniqueid:function(t){return this._uniqueid==t},_showInfo:function(t){var n=this,e=t.success,i=t.data;if(e){if(cc.log(this.Field,"show info:",i),this._fireData=i,this._fromPath=i.from||"",this.Label.string=i.text||"",cc.log("data.list:",i.list),this._listData=i.list||null,!this._listData)return;var s=this.Layout.getChildren();Object.keys(this._listData).map(function(t,e){var i=s[e]||cc.instantiate(n.ListItem),o=i.getComponent("ListFolder");i.parent=n.Layout,o&&o.setUniqueid(t,n._isUnfold)})}},checkContent:function(t){var o=this;this.CheckConditions.every(function(t){return t.target.getComponent(t.component)[t.handler](o._uniqueid)})&&a.check(this.Refer+this._fromPath+"/list/"+this._uniqueid).then(function(t){var e=t.success,i=t.data;e&&(o.node.color=i?cc.Color.YELLOW:cc.Color.GREEN,a.refresh(o.Refer+o._fromPath+"/list/"+o._uniqueid,!i))})},clickOnCheck:function(){this.checkContent()},clickOnFolder:function(){var e=this;cc.log("點擊bar",this._uniqueid,!this._isUnfold),this._isUnfold=!this._isUnfold,this.Layout.children.forEach(function(t){return t.active=e._isUnfold})},clickOnAddNew:function(){this.Dialog.create("NotifyAddNew"+this._viewUniqueid)},clickOnEdit:function(){this.Dialog.edit("NotifyModify"+this._viewUniqueid,this._fireData,this._uniqueid,this._isUnfold)},clickOnDel:function(){cc.log("del",this.Refer+this.Field+this._uniqueid+"/"),cc.log("&",this.Refer+this._fromPath),this.deleteContent()},clickOnBroadcast:function(){a.remind(this.Refer+"remind/",this._listData),cc.log("廣播:",this._listData)},clickOnFixPosition:function(t){var e=cc.director.getScene().children[0];this.node.setPosition(cc.v2(0,0)),this._isUnfold=!this._isUnfold,this._isUnfold?this.node.y=e.height-t.target.convertToWorldSpaceAR(cc.v2(.5*-e.width,0)).y:this.node.y=.5*e.height}}),cc._RF.pop()},{Firebase:"Firebase",HintWindow:"HintWindow"}],LoginDialog:[function(t,e,i){"use strict";cc._RF.push(e,"7530e9W6qJP0LB9jNQc+7Kq","LoginDialog"),cc.Class({extends:t("HintWindow"),properties:{EditBox:cc.EditBox},placeholder:function(t){this.EditBox.node.active=!0,this.EditBox.placeholder=t},close:function(){this.unschedule(this.close),this.Hint.string="",this.EditBox.node.active=!1,this.node.active=!1},login:function(t){this.hint("輸入暱稱"),this.placeholder(t),this.button("加入遊戲",this._login.bind(this))},createRoom:function(t){this.hint("Room name:"),this.button("Create",this._createRoom.bind(this)),this.button("Cancel",this._back.bind(this)),this.placeholder(t)},_login:function(t){NAERT.dispatchCustomEvent("NotifyPlayerLogin",{name:this._getInputData()},this),this.hide()},_createRoom:function(){NAERT.dispatchCustomEvent("NotifyCreateNewRoom",this._getInputData(),this),this.hide()},_back:function(){NAERT.dispatchCustomEvent("NotifyLobbyRoom",null,this),this.hide()},_getInputData:function(){var t=this.EditBox.string.length?this.EditBox.string:this.EditBox.placeholder;return this.EditBox.string="",t}}),cc._RF.pop()},{HintWindow:"HintWindow"}],MazeRoomItem:[function(t,e,i){"use strict";cc._RF.push(e,"f0e146WjPhP645Xsdj3J557","MazeRoomItem"),cc.Class({extends:t("DoorRoomItem"),properties:{Characters:t("CharacterManager"),ItemLayout:cc.Node,Item:cc.Node},setRef:function(t){this._refPath=t},_showGates:function(t,e){this.Characters.setGatesInfo(this._gates)},_showFloors:function(t){this.Characters.setFloorsInfo(this._floors),this.showItems(this._floors,t)},showItems:function(t,s){var c=this,r=this.ItemLayout.getChildren();r.forEach(function(t){return t.active=!1}),t.forEach(function(t,e){var i=t.items;if(i){var o=s[e].getPosition(),n=r[e]||cc.instantiate(c.Item);n.name=i,n.parent=c.ItemLayout,n.active=!0,n.setPosition(o.x,o.y)}})},playerLogin:function(t,e){this.Characters.login(t,e)},moveToTile:function(t,e,i,o){this._axis={x:t,y:e,stand:i},cc.log("moveToTile:",this._axis),this.Characters.moveToTile(t,e,i,o)}}),cc._RF.pop()},{CharacterManager:"CharacterManager",DoorRoomItem:"DoorRoomItem"}],Pitcher:[function(t,e,i){"use strict";cc._RF.push(e,"95992ff+5hKbJ3lCWJ1Op9k","Pitcher");var o=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)/Math.PI*180},r=function(t,e,i){return i?{x:t.x+1e-4*Math.floor(i*Math.cos(e*Math.PI/180)*1e4),y:t.y+1e-4*Math.floor(i*Math.sin(e*Math.PI/180)*1e4)}:t},s=function(t,e,i,o,n){var s={x:t.x,y:t.y};if(o){for(var c=0;.05<i;)s=r(s,e,i),i=a(i,o),c++;cc.log(c)}if(n)for(;0<n;)s=r(s,e,i),n--;return s},a=function(t,e){return.001<Math.abs(t)?t-=t*e:0},n=function(t,e){var i=Math.abs(t.x-e.x)<=.5*(t.width+e.width),o=Math.abs(t.y-e.y)<=.5*(t.height+e.height);return i&&o};e.exports={prediction:s,angle:o,project:r,retard:a,hit:n,reflectionAngle:function(t,e,i,o){var n=s(t,i,o,0,1);return Math.abs(n.x)>.5*(e.width-t.width)?180-i:Math.abs(n.y)>.5*(e.height-t.height)?-i:i}},cc._RF.pop()},{}],Poker:[function(t,e,i){"use strict";cc._RF.push(e,"62909MpjvZFb6Imcw5QBo3B","Poker");var o=t("Firebase"),s=["3","4","5","6","7","8","9","10","J","Q","K","A","2"],c=["♣","♦","♥","♠"];cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._refName="PokerRefDefaultName",this._libary=[],this._handCards=[]},create:function(){for(var t=s.length,e=c.length,i=parseInt(s[0]),o=0;o<t;o++)for(var n=0;n<e;n++)this._libary.push({worth:o*c.length+n,number:(o+i)%t,pattern:n,surface:c[n]+s[o]})},shuffle:function(){return this._libary.sort(function(){return.5-Math.random()}),this},deal:function(t){for(var e=Math.floor(this._libary.length/t),i=this._libary.length-e*t,o=0;o<t;o++)this._handCards.push(this._libary.splice(0,e));for(var n=0;n<i;n++)this._handCards[n].push(this._libary.shift());return this},save:function(t){t&&(this._refName=t),o.refresh(this._refName,{libary:this._libary,handCards:this._handCards})},clean:function(){o.destroy(this._refName)},sort:function(i){return this._libary.sort(function(t,e){return t[i]-e[i]}),this}}),cc._RF.pop()},{Firebase:"Firebase"}],SimpleMaze:[function(t,e,i){"use strict";cc._RF.push(e,"63215npVdtKs4n28lypXyrZ","SimpleMaze");var s=t("Firebase");cc.Class({extends:cc.Component,properties:{EscapeValue:5,ScoreLabel:cc.Label,PromptLabel:cc.Label,Dooroom:t("DoorRoom"),RoomItem:t("DoorRoomItem"),Heartbeat:t("Heartbeat"),Dialog:t("HintWindow"),LoginDialog:t("HintWindow")},start:function(){this.LoginDialog.login(NAERT.localStorage.getItem("nickname","路人_"+Math.round(100*Math.random()))),NAERT.addListener("NotifyPlayerLogin",this.onStart.bind(this)),this.ScoreLabel.string="",this._axisX=0,this._axisY=0,this._beating=!1},onStart:function(t){var e=this;this._nickname=t.detail.name,NAERT.localStorage.setItem("nickname",this._nickname),this._uniqueid=NAERT.localStorage.getItem("uniqueid",NAERT.randomUniqueCode()),s.refresh(this.Dooroom.Refer+this.Dooroom.Field+"players/"+this._uniqueid,{name:this._nickname,catch:0,pick:0}),this.Heartbeat.onStart(),this.ScoreLabel.string="Score:0",this.addListener(),window.onbeforeunload=this._onbeforeunload.bind(this),this._checkCheat(),this.PromptLabel.string="規則說明：\n向四方移動，逃離地城\n(從出生的房間為起點，6格房間外的即算成功逃離)\n手指觸碰地板並滑動整個介面並放開，\n可以朝反方向移動\n點擊此處看大地圖與排行榜",this.Dooroom.Mask.opacity=255,s.check(this.Dooroom.getTilePath(0,0,1)).then(function(t){t.success?e.Dooroom.load(0,0,1,4):e.Dooroom.create(0,0,1,4,e._defaultGatesData(),e._defaultFloorsData())})},addListener:function(){var o=this;NAERT.addListener("NotifyUIControlFlip",this._uiControlFlip.bind(this)),NAERT.addListener("NotifyUIControlPullPush",this._uiControlPullPush.bind(this)),NAERT.addListener("NotifyDoorRoomTrap",function(t){o.Dialog.trap(t.detail),o._isTraped=!0}),NAERT.addListener("NotifyHeartbeat",function(t){!o._beating&&s.remind(o.Dooroom.Refer+o.Dooroom.Field+"heartbeat/"+o.Dooroom._tileName(o._axisX,o._axisY,1),!0)}),s.listen(this.Dooroom.Refer+this.Dooroom.Field+"monster/",function(t){var e=t.success,i=t.data;return e&&o.RoomItem.notifyMonster(i)}),s.listen(this.Dooroom.Refer+this.Dooroom.Field+"heartbeat/",function(t){var e=t.success,i=t.data;return e&&o._checkBeat(i)}),s.listen(this.Dooroom.Refer+this.Dooroom.Field+"players/"+this._uniqueid,function(t){var e=t.success,i=t.data;return e&&o.earnScore(i.pick+i.catch)})},getRoomAxis:function(){return[this._axisX,this._axisY]},earnScore:function(t){var e=this.ScoreLabel.node;this.ScoreLabel.string="Score:"+t,e.stopAllActions(),e.setScale(1,1),e.runAction(cc.sequence(cc.spawn(cc.scaleTo(.2,2,2).easing(cc.easeElasticOut()),cc.tintTo(.2,255,0,0)),cc.spawn(cc.scaleTo(.3,1,1),cc.tintTo(.3,255,255,255))))},_checkBeat:function(t){var e=this;Object.keys(t).forEach(function(t){t==e.Dooroom._tileName(e._axisX,e._axisY,1)&&e.Heartbeat.beat()}),this._beating=!0,this.scheduleOnce(function(t){return e._beating=!1},1)},_uiControlPullPush:function(){},_uiControlFlip:function(t){!this._isTraped&&this._onMove(t.detail),this._isTraped=!1},_controlFlip:function(t){switch(t){case UIEnum.Flip.UP:this._axisY++;break;case UIEnum.Flip.LEFT:this._axisX--;break;case UIEnum.Flip.DOWN:this._axisY--;break;case UIEnum.Flip.RIGHT:this._axisX++}},_onMove:function(t){var n=this;if(this.RoomItem.checkPass(t)){if(this.RoomItem.stay(-1),this._controlFlip(t),Math.abs(this._axisX)>this.EscapeValue||Math.abs(this._axisY)>this.EscapeValue)return cc.log(this._axisX,this._axisY,this.EscapeValue),this.Dialog.escape(),void s.check(this.Dooroom.Refer+this.Dooroom.Field+"players/"+this._uniqueid).then(function(t){var e=t.success,i=t.data;if(e){var o=i.pick+i.catch;s.refresh(n.Dooroom.Refer+n.Dooroom.Field+"rank/"+n._uniqueid,{score:o,name:n._nickname})}});this.Dooroom.load(this._axisX,this._axisY,1,(t+2)%4)}},_onbeforeunload:function(){this.RoomItem.stay(-1)},_reloadwebsite:function(){window.location.reload()},_defaultGatesData:function(){return[{exist:!0},{exist:!0},{exist:!0},{exist:!0}]},_defaultFloorsData:function(){return[{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0},{exist:!0}]},_checkCheat:function(){t("querystring").parse(window.location.search.substring(1),"&","=").monster&&s.refresh(this.Dooroom.Refer+this.Dooroom.Field+"monster/",this._uniqueid)},clickOnMonster:function(){s.refresh(this.Dooroom.Refer+this.Dooroom.Field+"monster/",this._uniqueid)}}),cc._RF.pop()},{DoorRoom:"DoorRoom",DoorRoomItem:"DoorRoomItem",Firebase:"Firebase",Heartbeat:"Heartbeat",HintWindow:"HintWindow",querystring:3}],SmokeEffect:[function(t,e,i){"use strict";cc._RF.push(e,"bf641qL32lFx63+BJfkmRkI","SmokeEffect"),cc.Class({extends:cc.Component,properties:{Unit:cc.Node},onLoad:function(){},onEnable:function(){for(var t=this.node.children,e=0;e<30;e++){var i=t[e]||cc.instantiate(this.Unit);i.parent=this.node,this.floating(i)}},floating:function(t){t.stopAllActions();var e=.2*Math.round(10*Math.random()),i=Math.round(50*Math.random())-25,o=Math.round(70*Math.random()),n=Math.round(10*Math.random());t.setPosition(i,50*Math.random()-25),t.active=!0,t.opacity=120,t.setScale(e,e),t.runAction(cc.spawn(cc.moveTo(n,t.x,t.y+o),cc.sequence(cc.moveTo(.8*n,t.x+i,t.y).easing(cc.easeElasticOut()),cc.fadeTo(.2*n,0),cc.callFunc(this.floating.bind(this,t)))))}}),cc._RF.pop()},{}],Throw:[function(t,e,i){"use strict";cc._RF.push(e,"1cec8gXqW5HSK644uUQcF5o","Throw");var c=function(t,e,i){return i?{x:t.x+1e-4*Math.floor(i*Math.cos(e*Math.PI/180)*1e4),y:t.y+1e-4*Math.floor(i*Math.sin(e*Math.PI/180)*1e4)}:t},r=function(t,e){return.001<Math.abs(t)?t-=t*e:0};e.exports={prediction:function(t,e,i,o){for(var n={x:t.x,y:t.y},s=0;.05<i;)n=c(n,e,i),i=r(i,o),s++;return cc.log(s),n},angle:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)/Math.PI*180},project:c,retard:r},cc._RF.pop()},{}],TrapHint:[function(t,e,i){"use strict";cc._RF.push(e,"a6021cuLCBF4JYB4PHEGN2j","TrapHint");t("Firebase");cc.Class({extends:t("HintWindow"),properties:{Icons:[cc.Node]},onEnable:function(){this.EventButton.active=!1,this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()}),this._tween(this.node,[cc.v2(0,-5),cc.v2(0,0)],[0,255])},trap:function(){this.hint("不小心掉進洞裡了！"),this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()}),this.button("爬出來",this._traped.bind(this)),this.Icons.forEach(function(t){return t.active=!1}),this.Icons[0].active=!0},catched:function(){this.hint("你被抓到了！"),this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()}),this.button("重新再來",this._reloadwebsite.bind(this)),this.Icons.forEach(function(t){return t.active=!1}),this.Icons[1].active=!0},escape:function(){this.hint("成功脫逃！"),this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()}),this.button("再玩一次",this._reloadwebsite.bind(this)),this.Icons.forEach(function(t){return t.active=!1}),this.Icons[2].active=!0},seal:function(){this.hint("你無法離開這個地牢"),this.ButtonLayout.getChildren(cc.Button).forEach(function(t){return t.destroy()}),this.button("我明白了",this.close.bind(this)),this.Icons.forEach(function(t){return t.active=!1}),this.Icons[1].active=!0},_traped:function(){NAERT.dispatchCustomEvent("NotifyTraped","ok",this),this.hide()},_reloadwebsite:function(){window.location.reload()}}),cc._RF.pop()},{Firebase:"Firebase",HintWindow:"HintWindow"}],test:[function(t,e,i){"use strict";cc._RF.push(e,"ed2f1P8IlxKO5CzWB7o2gzS","test"),cc.Class({extends:cc.Component,properties:{cha:t("Character")},onLoad:function(){}}),cc._RF.pop()},{Character:"Character"}]},{},["ControlFlip","ControlFoldList","ControlMain","ControlPullPush","Firebase","IndexData","Dice","EventButton","EventDestroy","EventHover","GoogleLogin","HintWindow","ListFolder","Pitcher","Poker","Throw","Character","CharacterManager","DoorRoom","DoorRoomItem","DoorRoomMap","DoorRoomMazeItem","Heartbeat","HeartbeatMaze","MazeRoomItem","SimpleMaze","TrapHint","LoginDialog","SmokeEffect","test"]);